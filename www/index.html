<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>Video Store</title>        
    </head>
    <body>
        
        <div id="userbar" data-bind="with: userBarViewModel">
            <ul class="clearfix">
                <li data-bind="ifnot: isSignedIn">
                    <button id="buttonSignIn" data-bind="click: signIn">Sign In</button>
                    <button id="buttonRegister" data-bind="click: register">Register</button>
                    <form id="formCredentials">
                        <input type="text" data-bind="value: username" placeholder="Username"/>
                        <input id="userPassword" type="password" placeholder="Password" />
                        <label for="checkboxRememberMe">Remember me</label>
                        <input type="checkbox" id="checkboxRememberMe" data-bind="checked: rememberUser"/>
                    </form>
                </li>
                <li data-bind="if: isSignedIn">
                    <p data-bind="text: username"/>
                </li>                
                <li data-bind="if: isSignedIn">
                    <button data-bind="click: signOut">Sign Out</button>
                </li>
            </ul>
        </div>

        <div id="app" data-bind="template: {name: templateSelector, foreach: viewModelBackStack}"></div>

        <div data-bind="if: showNotificationBar" style="position: fixed; bottom: 0px; left: 0px; width: 100%; color: #fff; background: #000;">
            <p data-bind="text: appNotification" />
        </div>
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
        <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.0.js" type="text/javascript"></script>
        <script src="js/lib/knockout.mapping-latest.js" type="text/javascript"></script>
        <script src="js/lib/sha1.js" type="text/javascript"></script>
        <script type="text/javascript" src="cordova-2.2.0.js"></script>
        <script type="text/javascript" src="js/RestProviders/StoresProvider.js"></script>
        <script type="text/javascript" src="js/RestProviders/MoviesProvider.js"></script>
        <script type="text/javascript" src="js/RestProviders/UsersProvider.js"></script>
        <script type="text/javascript" src="js/ViewModels/ApplicationViewModel.js"></script>
        <script type="text/javascript" src="js/ViewModels/VideoStoresViewModel.js"></script>
        <script type="text/javascript" src="js/ViewModels/StoreViewModel.js"></script>
        <script type="text/javascript" src="js/ViewModels/MovieViewModel.js"></script>
        <script type="text/javascript" src="js/ViewModels/UserBarViewModel.js"></script>
        <script type="text/x-jquery-tmpl" charset="utf-8" id="videoStoresView">
            <div>
                <button data-bind="click: showAllStores">Show all stores</button>
                <button data-bind="click: showNearbyStores">Show nearby stores</button>
                <div style="width: 100%;" data-bind="foreach: stores">
                    <p style="width:100%" data-bind="click: $parent.showVideoStoreInfo, text: title"/>
                </div>
            </div>
        </script>
        <script type="text/x-jquery-tmpl" charset="utf-8" id="storeInfoView">
            <div data-bind="with: storeInfo">
                <h1 data-bind="text: title" />
                <ul style="width: 100%;" data-bind="foreach: movies">
                    <li>
                        <p style="width:100%" data-bind="click: $parents[1].showMovieInfo, text: title"/>
                    </li>
                </ul>
            </div>
        </script>
        <script type="text/x-jquery-tmpl" charset="utf-8" id="movieInfoView">
            <div data-bind="with: movieInfo">
                <h1 data-bind="text: title"/>
                <div>
                    <button data-bind="click: $parent.rentMovie">Rent</button>
                </div>
                <div>                    
                    <button data-bind="click: $parent.returnMovie">Return</button>
                </div>
                <p data-bind="text: description"/>
                <ul data-bind="foreach: categories">
                    <li data-bind="text: name"/>
                </ul>
            </div>
        </script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            var app;
            $(document).ready(function () {
                console.log("document ready");

                $.support.cors = true;

                app = new appMain();
                app.initialize();
            });                        
        </script>
    </body>
</html>
